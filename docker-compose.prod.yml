# ══════════════════════════════════════════════
# Production Docker Compose - Standalone
# For Coolify/Production deployment
# Usage: docker compose -f docker-compose.prod.yml up -d
# ══════════════════════════════════════════════

services:
  # ══════════════════════════════════════════════
  # Proxy API - Data aggregation service
  # Port: 3001
  # ══════════════════════════════════════════════
  proxy:
    build:
      context: .
      dockerfile: Dockerfile
      target: proxy
    container_name: polymarket-proxy
    restart: always
    ports:
      - "3001:3001"
    env_file:
      - .env
    environment:
      - RUST_LOG=${RUST_LOG:-info}
    networks:
      - polymarket-net
    # healthcheck:
    #   test: ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/localhost/3001' || exit 1"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3
    #   start_period: 15s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
        compress: "true"
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M

  # ══════════════════════════════════════════════
  # Dashboard - Multi-agent management UI
  # Port: 3000
  # Manages agents from web interface
  # ══════════════════════════════════════════════
  dashboard:
    build:
      context: .
      dockerfile: Dockerfile
      target: dashboard
    container_name: polymarket-dashboard
    restart: always
    ports:
      - "3000:3000"
    env_file:
      - .env
    environment:
      - RUST_LOG=${RUST_LOG:-info}
    volumes:
      # Persistent data for agent databases
      - agent-data:/app/data
      # Agent configurations
      - agent-configs:/app/configs
    depends_on:
      - proxy
    networks:
      - polymarket-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
        compress: "true"
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M

# ══════════════════════════════════════════════
# Volumes - Persistent storage
# ══════════════════════════════════════════════
volumes:
  agent-data:
    name: polymarket-agent-data
  agent-configs:
    name: polymarket-agent-configs

# ══════════════════════════════════════════════
# Networks
# ══════════════════════════════════════════════
networks:
  polymarket-net:
    name: polymarket-network
    driver: bridge
